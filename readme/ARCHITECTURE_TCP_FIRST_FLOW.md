# Visual Architecture: TCP First Flow

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PICO HARDWARE                           â”‚
â”‚  (Sensor device)                                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Sensor IN  â”‚  â”‚   Sensor OUT â”‚  â”‚   External   â”‚     â”‚
â”‚  â”‚   (rising)   â”‚  â”‚   (rising)   â”‚  â”‚   Events     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                 â”‚                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                  â”‚
          â”‚ TCP/UART        â”‚ TCP/UART         â”‚
          â–¼                 â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TCP CONTROLLER                             â”‚
â”‚  (Network Communication)                                    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Message Parser  â”‚  â”‚  Signal Router   â”‚               â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚               â”‚
â”‚  â”‚ "start_rising"   â”‚  â”‚ â†’ _handle_start  â”‚               â”‚
â”‚  â”‚ "end_rising"     â”‚  â”‚ â†’ _handle_end    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚
            â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RESULT TAB MANAGER                             â”‚
â”‚  (Frame & Status Management)                               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ on_sensor_in_received(sensor_id)                     â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â€¢ add_sensor_in_event()                             â”‚  â”‚
â”‚  â”‚  â€¢ frame_id_waiting_for_result = frame_id âœ“         â”‚  â”‚
â”‚  â”‚  â€¢ Frame appears in table                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ attach_job_result_to_waiting_frame(status, data)     â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â€¢ Find frame from frame_id_waiting_for_result       â”‚  â”‚
â”‚  â”‚  â€¢ set_frame_status(frame_id, OK/NG) âœ“              â”‚  â”‚
â”‚  â”‚  â€¢ Store detection_data                              â”‚  â”‚
â”‚  â”‚  â€¢ Frame status updates in table                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ add_sensor_out_event(sensor_id)                      â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â€¢ FIFO match to PENDING frame                       â”‚  â”‚
â”‚  â”‚  â€¢ Mark completion_status = DONE                     â”‚  â”‚
â”‚  â”‚  â€¢ Frame finalized in table                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FIFO Queue                                           â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚ [Frame 1]  [Frame 2]  [Frame 3]  ...                â”‚  â”‚
â”‚  â”‚  - frame_id                                          â”‚  â”‚
â”‚  â”‚  - sensor_id_in / sensor_id_out                      â”‚  â”‚
â”‚  â”‚  - frame_status (PENDING/OK/NG)                      â”‚  â”‚
â”‚  â”‚  - completion_status (PENDING/DONE)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CAMERA MANAGER                                â”‚
â”‚  (Job Execution & Result Processing)                       â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Manual Trigger (parallel operation)                  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â€¢ Capture frame from camera                         â”‚  â”‚
â”‚  â”‚  â€¢ Run job pipeline:                                 â”‚  â”‚
â”‚  â”‚    - Camera Source Tool                              â”‚  â”‚
â”‚  â”‚    - Detect Tool                                     â”‚  â”‚
â”‚  â”‚    - Result Tool                                     â”‚  â”‚
â”‚  â”‚  â€¢ Generate result (OK/NG)                           â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â†“ When complete:                                    â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â€¢ Call result_tab_manager                           â”‚  â”‚
â”‚  â”‚    .attach_job_result_to_waiting_frame() âœ“          â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RESULT TABLE (UI)                             â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ID â”‚   Status   â”‚ Sensor   â”‚ Sensor   â”‚ Completion   â”‚   â”‚
â”‚ â”‚    â”‚  (OK/NG)   â”‚ IN       â”‚ OUT      â”‚ (PENDING/    â”‚   â”‚
â”‚ â”‚    â”‚(ğŸŸ¡ğŸŸ¢ğŸ”´)     â”‚          â”‚          â”‚  DONE)ğŸ”µ     â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1  â”‚  ğŸŸ¡ PEND   â”‚ 12345    â”‚          â”‚ ğŸŸ¡ PENDING   â”‚   â”‚
â”‚ â”‚    â”‚            â”‚          â”‚          â”‚              â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1  â”‚  ğŸŸ¢ OK     â”‚ 12345    â”‚          â”‚ ğŸŸ¡ PENDING   â”‚   â”‚
â”‚ â”‚    â”‚            â”‚          â”‚          â”‚              â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 1  â”‚  ğŸŸ¢ OK     â”‚ 12345    â”‚ 67890    â”‚ ğŸ”µ DONE      â”‚   â”‚
â”‚ â”‚    â”‚            â”‚          â”‚          â”‚              â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚ (Table updates as state changes)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Sequence Diagram

```
PICO              TCP              Result Tab         Camera         UI Table
 â”‚                 â”‚                Manager           Manager        â”‚
 â”‚                 â”‚                  â”‚                 â”‚            â”‚
 â”‚                 â”‚                  â”‚   Click Trigger â”‚            â”‚
 â”‚                 â”‚                  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚                 â”‚                  â”‚                 â”‚ Start Job  â”‚
 â”‚                 â”‚                  â”‚                 â”œâ”€â”€â”€â”        â”‚
 â”‚                 â”‚                  â”‚                 â”‚   â”‚ Process
 â”‚                 â”‚                  â”‚                 â”‚ â—„â”€â”˜        â”‚
 â”‚                 â”‚                  â”‚                 â”‚            â”‚
 â”‚ start_risingâ”‚ID1â”‚                  â”‚                 â”‚            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                 â”‚                 â”‚            â”‚
 â”‚                 â”‚  on_sensor_in_   â”‚                 â”‚            â”‚
 â”‚                 â”‚  received()      â”‚                 â”‚            â”‚
 â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                 â”‚            â”‚
 â”‚                 â”‚ add_sensor_in_   â”‚                 â”‚            â”‚
 â”‚                 â”‚ event()          â”‚                 â”‚            â”‚
 â”‚                 â”‚ frame_id_waiting â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
 â”‚                 â”‚ = 1              â”‚ Display: Frame 1, PENDING
 â”‚                 â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ğŸŸ¡ PENDING, ğŸŸ¡ PENDING
 â”‚                 â”‚                  â”‚                 â”‚            â”‚
 â”‚                 â”‚                  â”‚   Result Ready  â”‚            â”‚
 â”‚                 â”‚                  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
 â”‚                 â”‚                  â”‚ attach_job_     â”‚            â”‚
 â”‚                 â”‚ result_to_       â”‚ waiting_frame() â”‚            â”‚
 â”‚                 â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ status=OK       â”‚            â”‚
 â”‚                 â”‚ set_frame_status  â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
 â”‚                 â”‚ (1, OK)           â”‚                 â”‚ Display: Frame 1, OK
 â”‚                 â”‚                  â”‚ frame_id_waitingâ”‚ ğŸŸ¢ OK, ğŸŸ¡ PENDING
 â”‚                 â”‚                  â”‚ = None          â”‚            â”‚
 â”‚                 â”‚                  â”‚                 â”‚            â”‚
 â”‚ end_risingâ”‚ID2  â”‚                  â”‚                 â”‚            â”‚
 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                 â”‚                 â”‚            â”‚
 â”‚                 â”‚ _handle_end_     â”‚                 â”‚            â”‚
 â”‚                 â”‚ rising()          â”‚                 â”‚            â”‚
 â”‚                 â”‚ add_sensor_out_  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
 â”‚                 â”‚ event()           â”‚ Display: Frame 1, OK
 â”‚                 â”‚ match to PENDING  â”‚ ğŸŸ¢ OK, 36247640, 36261996
 â”‚                 â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ ğŸ”µ DONE
 â”‚                 â”‚ status=DONE       â”‚                 â”‚            â”‚
 â”‚                 â”‚                  â”‚                 â”‚            â”‚
```

---

## ğŸ¬ Timeline

```
Time   Action                          Frame State
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 0ms   Manual Trigger                  (none)
       â””â”€ Job starts

200ms  ...Job processing...            (none)

2000ms TCP: start_rising||36247640     
       â””â”€ Frame Created               Frame 1: PENDING â†’ ğŸŸ¡
       â””â”€ Waiting for job result      

2300ms Job Complete (status=OK)
       â””â”€ Result Attached             Frame 1: OK â†’ ğŸŸ¢
       â””â”€ Frame_id_waiting = None

2800ms TCP: end_rising||36261996
       â””â”€ Sensor OUT matched          Frame 1: DONE â†’ ğŸ”µ
```

---

## ğŸ“Š State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      START      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    TCP start_rising
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Frame Created  â”‚
                    â”‚  Status=PENDING â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ (Waiting for    â”‚           â”‚
                    â”‚  job result)    â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
                             â”‚                    â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
              â”‚                             â”‚     â”‚
         Job Result                    Timeout/
         Ready                         Error
              â”‚                             â”‚
              â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Result Attached â”‚         â”‚  Discard Result    â”‚
    â”‚ Status=OK/NG âœ“  â”‚         â”‚  (frame kept)      â”‚
    â”‚ (Waiting for    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  sensor_out)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        TCP end_rising
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Frame Finalized â”‚
    â”‚ Status=DONE âœ“   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ Key Variables

### ResultTabManager
```
frame_id_waiting_for_result: Optional[int]
â”‚
â”œâ”€ None              â†’ No frame waiting for result
â”œâ”€ <int> (e.g., 1)  â†’ Frame 1 waiting for result
â””â”€ Gets reset when result attached
```

### FIFO Queue
```
Each Frame Item:
â”œâ”€ frame_id          â†’ Unique frame identifier
â”œâ”€ sensor_id_in      â†’ TCP start_rising ID
â”œâ”€ sensor_id_out     â†’ TCP end_rising ID
â”œâ”€ frame_status      â†’ PENDING / OK / NG
â””â”€ completion_status â†’ PENDING / DONE
```

---

## ğŸ¯ Integration Points

| Component | Method | Called From | Purpose |
|-----------|--------|-------------|---------|
| TCP Controller | `_handle_start_rising()` | TCP Parser | Parse start_rising signal |
| Result Tab Manager | `on_sensor_in_received()` | TCP Handler | Create frame entry |
| FIFO Queue | `add_sensor_in_event()` | Result Tab | Add frame to queue |
| Result Tab Manager | `attach_job_result_to_waiting_frame()` | Camera Manager | Attach job result |
| FIFO Queue | `set_frame_status()` | Result Tab | Update frame status |
| TCP Controller | `_handle_end_rising()` | TCP Parser | Parse end_rising signal |
| Result Tab Manager | `add_sensor_out_event()` | TCP Handler | Match sensor_out |
| FIFO Queue | `add_sensor_out_event()` | Result Tab | Match & finalize |

---

**Created**: 2025-11-11  
**Architecture Version**: 2.0 (TCP-First)  
**Status**: âœ… Complete
