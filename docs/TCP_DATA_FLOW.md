# ğŸ“Š TCP Data Flow - TrÆ°á»›c & Sau Fix

## ğŸ”´ TRÆ¯á»šC (Lá»—i)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INTERFACE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ipLineEdit: 192.168.1.100                                   â”‚
â”‚  portLineEdit: 5000                                          â”‚
â”‚  [Connect] â†’ Connected âœ“                                     â”‚
â”‚                                                               â”‚
â”‚  messageLineEdit: PING                                       â”‚
â”‚  [Send] â†’ TX: PING âœ“                                         â”‚
â”‚                                                               â”‚
â”‚  messageListWidget:                                          â”‚
â”‚  - Status: Connected                                         â”‚
â”‚  - TX: PING                                                  â”‚
â”‚  - âŒ RX: [KHÃ”NG CÃ“]  â† Bá»Š Máº¤T ÄÃ‚Y!                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†‘ (GUI)
                         â”‚ (Signal emit)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              tcp_controller_manager.py                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  _on_message_received(message)                               â”‚
â”‚      â†‘ (message_received signal)                             â”‚
â”‚      â”‚ âŒ SIGNAL KHÃ”NG ÄÆ¯á»¢C PHÃT â† Lá»–I ÄÃ‚Y                  â”‚
â”‚      â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†‘
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               tcp_controller.py (Main)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  send_message("PING") âœ“                                      â”‚
â”‚      â†“ Socket.send()                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚ Monitor Thread  â”‚                                         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                         â”‚
â”‚  â”‚ while running:  â”‚                                         â”‚
â”‚  â”‚  data = socket. â”‚                                         â”‚
â”‚  â”‚    recv(1024)   â”‚                                         â”‚
â”‚  â”‚  âŒ TIMEOUT (3s)â”‚ â† NGáº®N QUÃC!                            â”‚
â”‚  â”‚    BLOCK HÃŠT!   â”‚                                         â”‚
â”‚  â”‚  [KhÃ´ng xá»­ lÃ½]  â”‚                                         â”‚
â”‚  â”‚  daemon=True âŒ â”‚ â† Máº¤T Dá»® LIá»†U                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚      â†‘                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†‘
             â”‚ Socket Connection
             â”‚ (KHÃ”NG NHáº¬N Dá»® LIá»†U)
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   DEVICE TCP   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Nháº­n: PING     â”‚
    â”‚ Gá»­i: PONG\r\n  â”‚
    â”‚ âŒ TRá»Š KHÃ”NG   â”‚
    â”‚    ÄÆ¯á»¢C NHáº¬N   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… SAU (Sá»­a)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INTERFACE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  ipLineEdit: 192.168.1.100                                   â”‚
â”‚  portLineEdit: 5000                                          â”‚
â”‚  [Connect] â†’ Connected âœ“                                     â”‚
â”‚                                                               â”‚
â”‚  messageLineEdit: PING                                       â”‚
â”‚  [Send] â†’ TX: PING âœ“                                         â”‚
â”‚                                                               â”‚
â”‚  messageListWidget:                                          â”‚
â”‚  - Status: Connected                                         â”‚
â”‚  - TX: PING                                                  â”‚
â”‚  - âœ… RX: PONG â† NHáº¬N ÄÆ¯á»¢C ÄÃ‚Y!                              â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†‘ (GUI)
                         â”‚ (Signal emit)
                         â”‚ âœ“ Nháº­n Ä‘Æ°á»£c message
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              tcp_controller_manager.py                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  _on_message_received(message) âœ“                             â”‚
â”‚      â†‘ (message_received signal)                             â”‚
â”‚      â”‚ âœ“ Signal Ä‘Æ°á»£c phÃ¡t                                    â”‚
â”‚      â”‚ âœ“ Handler Ä‘Æ°á»£c gá»i                                    â”‚
â”‚      â”‚ âœ“ messageListWidget.addItem("RX: PONG")              â”‚
â”‚      â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†‘
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               tcp_controller.py (Main)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  send_message("PING") âœ“                                      â”‚
â”‚      â†“ Socket.send()                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  Monitor Thread       â”‚                                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚  â”‚  while running:       â”‚                                   â”‚
â”‚  â”‚   data = socket.recv( â”‚                                   â”‚
â”‚  â”‚     1024)             â”‚                                   â”‚
â”‚  â”‚  âœ“ TIMEOUT (30s) OK!  â”‚ â† Äá»¦ LÃ‚UUUU!                     â”‚
â”‚  â”‚  âœ“ recv() thÃ nh cÃ´ng  â”‚                                   â”‚
â”‚  â”‚  âœ“ Decode UTF-8       â”‚                                   â”‚
â”‚  â”‚  buffer += data       â”‚                                   â”‚
â”‚  â”‚  âœ“ Split by '\n'      â”‚                                   â”‚
â”‚  â”‚  âœ“ Buffer timeout(0.5)â”‚ â† Há»– TRá»¢ KHÃ”NG \n                â”‚
â”‚  â”‚  âœ“ emit signal âœ“      â”‚                                   â”‚
â”‚  â”‚  daemon=False âœ“       â”‚ â† AN TOÃ€N Dá»® LIá»†U               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚      â†‘                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†‘
             â”‚ Socket Connection
             â”‚ âœ“ NHáº¬N Dá»® LIá»†U
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   DEVICE TCP   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Nháº­n: PING     â”‚
    â”‚ Gá»­i: PONG\r\n  â”‚
    â”‚ âœ“ Dá»® LIá»†U      â”‚
    â”‚   ÄÆ¯á»¢C NHáº¬N    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ DÃ²ng Thá»i Gian (Timeline)

### âŒ TRÆ¯á»šC (Timeout)

```
Time  â”‚ Event
â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0s    â”‚ [User click Send]
      â”‚ TX: PING (xong)
      â”‚
0s    â”‚ [Socket.send(PING)]
      â”‚
0s    â”‚ [Monitor Thread recv() timeout = 3s]
      â”‚
0.5s  â”‚ [Device receives PING]
      â”‚ [Device sends PONG\r\n]
      â”‚
1s    â”‚ [Socket has data ready]
      â”‚ âŒ But recv() still waiting for what?
      â”‚
2s    â”‚ [Still waiting...]
      â”‚
3s    â”‚ âŒ TIMEOUT! recv() raises exception
      â”‚ âŒ Data LOST! Never processed
      â”‚
      â”‚ RX: [KHÃ”NG CÃ“]
```

### âœ… SAU (Nháº­n ÄÆ°á»£c)

```
Time  â”‚ Event
â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0s    â”‚ [User click Send]
      â”‚ TX: PING (xong)
      â”‚
0s    â”‚ [Socket.send(PING)]
      â”‚
0s    â”‚ [Monitor Thread recv() timeout = 30s]
      â”‚
0.5s  â”‚ [Device receives PING]
      â”‚ [Device sends PONG\r\n]
      â”‚
1s    â”‚ [Socket has data ready]
      â”‚ âœ“ recv() returns data immediately
      â”‚ âœ“ Decode: 'PONG\r\n'
      â”‚ âœ“ Buffer: "PONG"
      â”‚ âœ“ Split by '\n': "PONG"
      â”‚ âœ“ emit signal
      â”‚
1.1s  â”‚ [_on_message_received() called]
      â”‚ âœ“ messageList.addItem("RX: PONG")
      â”‚
1.2s  â”‚ GUI updated âœ“
      â”‚ RX: PONG
```

---

## ğŸ”„ Data Flow Diagram

### âŒ TRÆ¯á»šC

```
Device
  â”‚
  â”œâ”€â†’ TCP Socket â”€â”€â†’ Kernel Buffer
  â”‚                       â”‚
  â”‚                       â”œâ”€â†’ recv(1024) [TIMEOUT 3s]
  â”‚                       â”‚     â””â”€â†’ âŒ Timeout!
  â”‚                       â”‚
  â”‚                       â””â”€â†’ Data LOST!
  â”‚
GUI âŒ RX: KhÃ´ng hiá»ƒn thá»‹
```

### âœ… SAU

```
Device
  â”‚
  â”œâ”€â†’ TCP Socket â”€â”€â†’ Kernel Buffer
  â”‚                       â”‚
  â”‚                       â”œâ”€â†’ recv(1024) [TIMEOUT 30s] âœ“
  â”‚                       â”‚     â””â”€â†’ âœ“ Data received!
  â”‚                       â”‚
  â”‚                       â””â”€â†’ Decode âœ“
  â”‚                             â”‚
  â”‚                             â””â”€â†’ Buffer âœ“
  â”‚                                   â”‚
  â”‚                                   â””â”€â†’ Split by '\n' âœ“
  â”‚                                         â”‚
  â”‚                                         â””â”€â†’ emit signal âœ“
  â”‚                                               â”‚
GUI                                              â”œâ”€â†’ Handler âœ“
  â”‚                                              â”‚
  â”œâ”€ RX: PONG âœ“ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
```

---

## ğŸ¯ Key Fixes Visualization

### Fix 1: Socket Timeout

```
TRÆ¯á»šC:  â–¶ï¸â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [3 seconds] [TIMEOUT] âŒ
SAU:    â–¶ï¸â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [30 seconds] [OK] âœ“
```

### Fix 2: Buffer Timeout

```
TRÆ¯á»šC:  Data [NO NEWLINE] â”€â”€â†’ STUCK IN BUFFER âŒ
SAU:    Data [NO NEWLINE] â”€â”€â†’ [0.5s timeout] â”€â”€â†’ EMIT âœ“
```

### Fix 3: Thread Daemon

```
TRÆ¯á»šC:  daemon=True  â†’ Main exits â†’ Thread KILLED âŒ
SAU:    daemon=False â†’ Main exits â†’ Thread continues âœ“
```

### Fix 4: Logging

```
TRÆ¯á»šC:  âŒ [Silent] â†’ No debug info
SAU:    âœ“ [Logged] â†’ Full trace:
        - Raw data received
        - Decoded data
        - Buffer processing
        - Signal emitted
        - Handler called
        - UI updated
```

---

**âœ… Táº¥t cáº£ 4 fixes Ä‘Ã£ Ã¡p dá»¥ng = Data flow thÃ nh cÃ´ng! ğŸ‰**
